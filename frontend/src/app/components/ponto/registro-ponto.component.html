<!-- Container Principal -->
<div class="min-h-screen w-full font-sans transition-colors duration-300 flex items-center justify-center p-4"
  [class.bg-gray-100]="!modoEscuro()" [class.bg-gray-900]="modoEscuro()">

  <!-- Anima√ß√£o de Flash para Captura de Foto -->
  <div *ngIf="mostrarFlash()" class="fixed inset-0 bg-white z-[100] flash-animation pointer-events-none">
  </div>
  <style>
    .flash-animation {
      opacity: 1;
      animation: flash 0.5s ease-out;
    }

    @keyframes flash {
      from {
        opacity: 1;
      }

      to {
        opacity: 0;
      }
    }
  </style>

  <!-- Notifica√ß√µes (Toasts) no Canto Superior -->
  <div class="fixed top-5 right-5 z-[999] space-y-3 w-full max-w-xs">
    <div *ngIf="mensagemSucesso()"
      class="bg-green-500 text-white text-sm font-semibold px-4 py-3 rounded-lg shadow-lg flex items-center gap-3">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <span>{{ mensagemSucesso() }}</span>
    </div>
    <div *ngIf="mensagemErro()"
      class="bg-red-500 text-white text-sm font-semibold px-4 py-3 rounded-lg shadow-lg flex items-center gap-3">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <span>{{ mensagemErro() }}</span>
    </div>
  </div>

  <!-- Bot√µes de A√ß√£o no Topo (Tema e Configura√ß√µes) -->
  <div class="absolute top-5 left-5 flex items-center gap-3 z-40">
    <button (click)="alternarTema()"
      class="h-10 w-10 flex items-center justify-center rounded-full transition-all duration-300"
      [class.bg-gray-800]="modoEscuro()" [class.text-yellow-400]="modoEscuro()" [class.bg-white]="!modoEscuro()"
      [class.text-indigo-600]="!modoEscuro()" [class.hover:bg-gray-700]="modoEscuro()"
      [class.hover:bg-gray-200]="!modoEscuro()">
      <span *ngIf="modoEscuro()" class="text-xl">‚òÄÔ∏è</span>
      <span *ngIf="!modoEscuro()" class="text-xl">üåô</span>
    </button>
    <button (click)="refresh()"
      class="h-10 w-10 flex items-center justify-center rounded-full transition-all duration-300"
      [class.bg-gray-800]="modoEscuro()" [class.text-yellow-400]="modoEscuro()" [class.bg-white]="!modoEscuro()"
      [class.text-indigo-600]="!modoEscuro()" [class.hover:bg-gray-700]="modoEscuro()"
      [class.hover:bg-gray-200]="!modoEscuro()">
      <span class="text-xl">üîÑ</span>
    </button>
    <button (click)="mostrarConfiguracoes.set(true)"
      class="h-10 w-10 flex items-center justify-center rounded-full transition-all duration-300"
      [class.bg-gray-800]="modoEscuro()" [class.text-white]="modoEscuro()" [class.bg-white]="!modoEscuro()"
      [class.text-gray-700]="!modoEscuro()" [class.hover:bg-gray-700]="modoEscuro()"
      [class.hover:bg-gray-200]="!modoEscuro()">
      <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
        stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round"
          d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.438.995s.145.755.438.995l1.003.827c.48.398.668 1.03.26 1.431l-1.296 2.247a1.125 1.125 0 01-1.37.49l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.063-.374-.313-.686-.645-.87a6.52 6.52 0 01-.22-.127c-.324-.196-.72-.257-1.075-.124l-1.217.456a1.125 1.125 0 01-1.37-.49l-1.296-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.437-.995s-.145-.755-.437-.995l-1.004-.827a1.125 1.125 0 01-.26-1.431l1.296-2.247a1.125 1.125 0 011.37-.49l1.217.456c.355.133.75.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.213-1.28z" />
        <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
      </svg>
    </button>
  </div>

  <!-- Card Principal -->
  <div class="w-full max-w-xl rounded-2xl shadow-2xl p-6 sm:p-8 space-y-6 transition-all duration-300"
    [class.bg-white]="!modoEscuro()" [class.bg-gray-800]="modoEscuro()" [class.text-gray-800]="!modoEscuro()"
    [class.text-gray-200]="modoEscuro()">

    <!-- Header do Card -->
    <div class="text-center">
      <h1 class="text-2xl font-bold flex items-center justify-center gap-2" [class.text-gray-900]="!modoEscuro()"
        [class.text-white]="modoEscuro()">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor"
          stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        Registro de Ponto
      </h1>
      <p class="text-sm" [class.text-gray-500]="!modoEscuro()" [class.text-gray-400]="modoEscuro()">
        Insira seu CPF e tire uma foto para registrar
      </p>
    </div>

    <!-- Status Online/Offline e Sincroniza√ß√£o -->
    <div class="flex justify-between items-center text-xs font-medium">
      <span class="px-3 py-1 rounded-full flex items-center gap-1.5" [ngClass]="{
                'bg-green-100 text-green-800': statusOnline() && !modoEscuro(),
                'bg-green-900/50 text-green-300': statusOnline() && modoEscuro(),
                'bg-red-100 text-red-800': !statusOnline() && !modoEscuro(),
                'bg-red-900/50 text-red-300': !statusOnline() && modoEscuro()
            }">
        <span class="h-2 w-2 rounded-full" [class.bg-green-500]="statusOnline()"
          [class.bg-red-500]="!statusOnline()"></span>
        {{ statusOnline() ? 'Online' : 'Offline' }}
      </span>

      <div *ngIf="carregandoSincronizacao(); else syncButton"
        class="text-xs font-semibold text-blue-500 flex items-center gap-2">
        <svg class="animate-spin h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
        </svg>
        <span>Sincronizando {{ vm.registrosSincronizados() }}/{{ vm.totalRegistros() }}</span>
      </div>
      <ng-template #syncButton>
        <button (click)="iniciarSincronizacao()"
          class="px-3 py-1 bg-indigo-600 text-white text-xs font-medium rounded-full shadow hover:bg-indigo-700 transition-colors flex items-center gap-1">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
            stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M9 3.75H6.912a2.25 2.25 0 00-2.15 1.588L2.35 13.177a2.25 2.25 0 00-.1.661V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18v-4.162c0-.224-.034-.447-.1-.661L19.24 5.338a2.25 2.25 0 00-2.15-1.588H15M2.25 13.5h3.86a2.25 2.25 0 012.012 1.244l.256.512a2.25 2.25 0 002.013 1.244h3.218a2.25 2.25 0 002.013-1.244l.256-.512a2.25 2.25 0 012.013-1.244h3.859M12 3v8.25m0 0l-3-3m3 3l3-3" />
          </svg>
          Sincronizar
        </button>
      </ng-template>
    </div>

    <!-- Alerta de Vincula√ß√£o do Dispositivo -->
    <div class="space-y-2 text-sm">
      <ng-container *ngIf="vinculoDispositivo(); else naoVinculado">
        <div class="p-3 border-l-4 rounded-r-lg shadow-sm flex flex-col gap-1" [class.bg-green-50]="!modoEscuro()"
          [class.border-green-500]="!modoEscuro()" [class.text-gray-700]="!modoEscuro()"
          [class.bg-green-900]="modoEscuro()" [class.border-green-400]="modoEscuro()"
          [class.text-gray-300]="modoEscuro()">
          <div class="font-bold flex items-center gap-2" [class.text-green-800]="!modoEscuro()"
            [class.text-green-300]="modoEscuro()">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd"
                d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                clip-rule="evenodd" />
            </svg>
            Dispositivo Vinculado
          </div>
          <span class="pl-7 text-xs">Munic√≠pio: <strong>{{ vinculoDispositivo()?.municipioNome }}</strong></span>
          <span class="pl-7 text-xs">Setor: <strong>{{ vinculoDispositivo()?.setorNome }}</strong></span>
        </div>
      </ng-container>
      <ng-template #naoVinculado>
        <div class="p-3 border-l-4 rounded-r-lg shadow-sm flex items-center gap-2" [class.bg-red-50]="!modoEscuro()"
          [class.text-red-800]="!modoEscuro()" [class.border-red-500]="!modoEscuro()" [class.bg-red-900]="modoEscuro()"
          [class.text-red-200]="modoEscuro()" [class.border-red-400]="modoEscuro()">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd"
              d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
              clip-rule="evenodd" />
          </svg>
          <strong>Dispositivo n√£o vinculado.</strong> Contate o administrador.
        </div>
      </ng-template>
    </div>

    <!-- Formul√°rio -->
    <form [formGroup]="form" (ngSubmit)="registrarPonto()" class="space-y-4">
      <!-- Input CPF -->
      <div>
        <label for="cpf" class="block text-sm font-medium mb-1.5" [class.text-gray-700]="!modoEscuro()"
          [class.text-gray-300]="modoEscuro()">
          CPF do Colaborador
        </label>
        <input #cpfInput id="cpf" formControlName="cpf" placeholder="000.000.000-00" mask="000.000.000-00"
          [dropSpecialCharacters]="true"
          class="w-full px-4 py-2.5 border rounded-lg text-base shadow-sm transition-all duration-300 focus:outline-none focus:ring-2"
          [class.border-gray-300]="!modoEscuro()" [class.bg-gray-50]="!modoEscuro()"
          [class.text-gray-900]="!modoEscuro()" [class.focus:ring-indigo-500]="!modoEscuro()"
          [class.focus:border-indigo-500]="!modoEscuro()" [class.border-gray-600]="modoEscuro()"
          [class.bg-gray-700]="modoEscuro()" [class.text-gray-100]="modoEscuro()"
          [class.focus:ring-indigo-400]="modoEscuro()" [class.focus:border-indigo-400]="modoEscuro()" />
        <small *ngIf="form.get('cpf')?.invalid && form.get('cpf')?.touched" class="text-red-500 mt-1.5 block text-xs">
          Por favor, insira um CPF v√°lido.
        </small>
      </div>

      <!-- C√¢mera e Captura de Foto -->
      <div class="relative w-full aspect-video bg-black rounded-lg overflow-hidden border-2 border-dashed"
        [class.border-gray-300]="!modoEscuro()" [class.border-gray-600]="modoEscuro()">

        <!-- Estado de Carregamento da C√¢mera -->
        <div *ngIf="carregandoCamera() && !fotoCapturada()"
          class="absolute inset-0 flex flex-col items-center justify-center bg-black bg-opacity-70 z-20">
          <svg class="animate-spin h-8 w-8 text-white" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" />
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z" />
          </svg>
          <p class="text-white mt-3 text-sm">Iniciando c√¢mera...</p>
        </div>

        <!-- Visualiza√ß√£o da C√¢mera -->
        <video *ngIf="!fotoCapturada()" id="video" autoplay playsinline muted
          class="w-full h-full object-cover transform scale-x-[-1]"></video>

        <!-- Imagem Capturada -->
        <img *ngIf="fotoCapturada()" [src]="imagemCapturada"
          class="w-full h-full object-cover transform scale-x-[-1]" />
      </div>

      <!-- Bot√µes de A√ß√£o do Formul√°rio -->
      <div class="flex flex-col sm:flex-row gap-2 pt-2">
        <button type="button" *ngIf="!fotoCapturada()" (click)="tirarFoto()"
          class="w-full sm:w-1/2 flex items-center justify-center gap-2 px-3 py-3 bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-medium rounded-md shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-indigo-500">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd"
              d="M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4zm6 9a3 3 0 100-6 3 3 0 000 6z"
              clip-rule="evenodd" />
          </svg>
          Tirar Foto
        </button>

        <button type="button" *ngIf="fotoCapturada()" (click)="repetirFoto()"
          class="w-full sm:w-1/2 flex items-center justify-center gap-2 px-3 py-3 bg-yellow-500 hover:bg-yellow-600 text-white text-sm font-medium rounded-md shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-yellow-500">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd"
              d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z"
              clip-rule="evenodd" />
          </svg>
          Repetir
        </button>

        <button type="submit" [disabled]="form.invalid || !fotoCapturada() || vm.registrandoPonto()"
          class="w-full sm:w-1/2 flex items-center justify-center gap-2 px-3 py-3 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-md shadow-sm transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed disabled:bg-gray-400">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd"
              d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
              clip-rule="evenodd" />
          </svg>
          Registrar Ponto
        </button>
      </div>

    </form>
  </div>
</div>

<!-- Modal de Configura√ß√µes (A l√≥gica permanece a mesma) -->
<app-configuracoes *ngIf="mostrarConfiguracoes()" [deviceIdentifier]="deviceIdentifier"
  [dispositivosVideo]="dispositivosVideo" [dispositivoSelecionadoId]="dispositivoSelecionadoId"
  [modoEscuro]="modoEscuro()" (selecionarDispositivo)="onSelecionarDispositivo($event)"
  (fechar)="fecharModalConfiguracoes()" (aposCopiarCodigo)="focarCPF()">
</app-configuracoes>